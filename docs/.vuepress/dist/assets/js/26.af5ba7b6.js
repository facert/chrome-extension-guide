(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{422:function(e,t,a){"use strict";a.r(t);var n=a(42),s=Object(n.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"保持安全"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#保持安全"}},[e._v("#")]),e._v(" 保持安全")]),e._v(" "),a("p",[e._v("扩展程序可以访问浏览器中的特殊特权，从而使它们成为攻击者的目标。如果某个扩展遭到破坏，则该扩展的所有用户都容易受到恶意和有害入侵的攻击。通过采用这些做法，可以确保扩展的安全性及其用户的安全。")]),e._v(" "),a("h3",{attrs:{id:"保护开发者帐户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#保护开发者帐户"}},[e._v("#")]),e._v(" 保护开发者帐户")]),e._v(" "),a("p",[e._v("扩展代码通过 Google 帐户上传和更新。如果开发人员的帐户遭到入侵，攻击者可能会将恶意代码直接推送给所有用户。通过专门创建开发人员帐户并启用"),a("a",{attrs:{href:"https://support.google.com/accounts/answer/185839?hl=en",target:"_blank",rel:"noopener noreferrer"}},[e._v("二次身份验证"),a("OutboundLink")],1),e._v("（最好使用安全密钥）来保护这些帐户。")]),e._v(" "),a("h4",{attrs:{id:"保持组的可选性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#保持组的可选性"}},[e._v("#")]),e._v(" 保持组的可选性")]),e._v(" "),a("p",[e._v("如果使用组发布，则将组限制在受信任的开发人员中。不接受来自陌生人的会员要求。")]),e._v(" "),a("h3",{attrs:{id:"永远不要使用-http"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#永远不要使用-http"}},[e._v("#")]),e._v(" 永远不要使用 HTTP")]),e._v(" "),a("p",[e._v("请求或发送数据时，避免使用 HTTP 连接。假定任何 HTTP 连接都具有窃听者或包含修改。始终应首选 HTTPS，因为它具有内置的安全性，可以绕过大多数"),a("a",{attrs:{href:"https://www.owasp.org/index.php/Man-in-the-middle_attack",target:"_blank",rel:"noopener noreferrer"}},[e._v("中间人攻击"),a("OutboundLink")],1),e._v("。")]),e._v(" "),a("h3",{attrs:{id:"要求最低权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#要求最低权限"}},[e._v("#")]),e._v(" 要求最低权限")]),e._v(" "),a("p",[e._v("Chrome 浏览器将扩展程序的访问权限限制为 manifest 中已明确请求的权限。扩展应仅通过注册其依赖的 API 和网站来最大程度地减少其权限。 随意的代码应保持最小化。")]),e._v(" "),a("p",[e._v("限制扩展权限会限制潜在攻击者可以利用的内容。")]),e._v(" "),a("h4",{attrs:{id:"跨域xmlhttprequest"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域xmlhttprequest"}},[e._v("#")]),e._v(" 跨域XMLHttpRequest")]),e._v(" "),a("p",[e._v("扩展只能使用 XMLHttpRequest 从自身和权限中指定的域中获取资源。")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(' {\n    "name": "Very Secure Extension",\n    "version": "1.0",\n    "description": "Example of a Secure Extension",\n    "permissions": [\n      "https://developer.chrome.com/*",\n      "https://*.google.com/"\n    ],\n    "manifest_version": 2\n  }\n')])])]),a("p",[e._v("此扩展程序通过在权限中列出 “https://developer.chrome.com/* ” 和 “https：//*google.com/” 来请求访问developer.chrome.com 和Google 子域上的任何内容。如果扩展名遭到入侵，它仍然仅具有与符合匹配模式的网站进行交互的权限。攻击者将无法访问“https://user_bank_info.com” 或与“https://malicious_website.com” 进行交互。")]),e._v(" "),a("h3",{attrs:{id:"限制-manifest-字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#限制-manifest-字段"}},[e._v("#")]),e._v(" 限制 manifest 字段")]),e._v(" "),a("p",[e._v("在 manifest 中包含不必要的注册会产生漏洞，并使扩展更可见。将 manifest 字段限制为扩展所依赖的字段并进行特定的字段注册。")]),e._v(" "),a("h4",{attrs:{id:"externally-connectable"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#externally-connectable"}},[e._v("#")]),e._v(" Externally Connectable")]),e._v(" "),a("p",[e._v("使用 "),a("a",{attrs:{href:"https://developer.chrome.com/manifest/externally_connectable",target:"_blank",rel:"noopener noreferrer"}},[e._v("externally_connectable"),a("OutboundLink")],1),e._v(" 字段来声明该扩展程序将与之交换信息的外部扩展程序和网页。 限制扩展与外部连接的来源。")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(' {\n    "name": "Super Safe Extension",\n    "externally_connectable": {\n      "ids": [\n        "iamafriendlyextensionhereisdatas"\n      ],\n      "matches": [\n        "https://developer.chrome.com/*",\n        "https://*google.com/"\n      ],\n      "accepts_tls_channel_id": false\n    },\n    ...\n  }\n')])])]),a("h4",{attrs:{id:"web-accessible-resources"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#web-accessible-resources"}},[e._v("#")]),e._v(" Web Accessible Resources")]),e._v(" "),a("p",[e._v("通过在 web_accessible_resources 下使资源可通过 Web 访问，将使网站和攻击者可以检测到扩展。")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('{\n  ...\n  "web_accessible_resources": [\n    "images/*.png",\n    "style/secure_extension.css",\n    "script/secure_extension.js"\n  ],\n  ...\n}\n')])])]),a("p",[e._v("可用的 Web 访问资源越多，潜在的攻击者就可以利用更多的途径。将这些文件减至最少。")]),e._v(" "),a("h3",{attrs:{id:"包括明确的内容安全政策"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#包括明确的内容安全政策"}},[e._v("#")]),e._v(" 包括明确的内容安全政策")]),e._v(" "),a("p",[e._v("在 manifest 中包含扩展的内容安全性策略，以防止跨站脚本攻击。如果扩展仅从自身加载资源，请注册以下内容：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('  {\n    "name": "Very Secure Extension",\n    "version": "1.0",\n    "description": "Example of a Secure Extension",\n    "content_security_policy": "default-src \'self\'"\n    "manifest_version": 2\n  }\n\n')])])]),a("p",[e._v("如果扩展需要包括来自特定主机的脚本，则可以包括以下脚本：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(' {\n    "name": "Very Secure Extension",\n    "version": "1.0",\n    "description": "Example of a Secure Extension",\n    "content_security_policy": "default-src \'self\' https://extension.resource.com"\n    "manifest_version": 2\n  }\n')])])]),a("h3",{attrs:{id:"避免使用可执行-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#避免使用可执行-api"}},[e._v("#")]),e._v(" 避免使用可执行 API")]),e._v(" "),a("p",[e._v("可执行代码的 API 应该替换为更安全的方法。")]),e._v(" "),a("h4",{attrs:{id:"document-write-和-innerhtml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#document-write-和-innerhtml"}},[e._v("#")]),e._v(" document.write() 和 innerHTML")]),e._v(" "),a("p",[e._v("虽然使用 document.write() 和 innerHTML 动态创建 HTML 元素可能更简单，但它会留下扩展以及该扩展名所依赖的网页，从而使攻击者可以插入恶意脚本。应该手动创建 DOM 节点，并使用innerText 插入动态内容。")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("function constructDOM() {\n    let newTitle = document.createElement('h1');\n    newTitle.innerText = host;\n    document.appendChild(newTitle);\n  }\n")])])]),a("h4",{attrs:{id:"eval"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#eval"}},[e._v("#")]),e._v(" eval()")]),e._v(" "),a("p",[e._v("尽可能避免使用 eval() 来防止攻击，因为eval() 会执行传递给它的任何代码，这可能是恶意的。")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(' var xhr = new XMLHttpRequest();\n  xhr.open("GET", "https://api.example.com/data.json", true);\n  xhr.onreadystatechange = function() {\n    if (xhr.readyState == 4) {\n      // WARNING! Might be evaluating an evil script!\n      var resp = eval("(" + xhr.responseText + ")");\n      ...\n    }\n  }\n  xhr.send();\n')])])]),a("p",[e._v("取而代之的是，更安全，更快的方法，例如JSON.parse()")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(' var xhr = new XMLHttpRequest();\n  xhr.open("GET", "https://api.example.com/data.json", true);\n  xhr.onreadystatechange = function() {\n    if (xhr.readyState == 4) {\n      // JSON.parse does not evaluate the attacker\'s scripts.\n      var resp = JSON.parse(xhr.responseText);\n    }\n  }\n  xhr.send();\n')])])]),a("h3",{attrs:{id:"谨慎使用内容脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#谨慎使用内容脚本"}},[e._v("#")]),e._v(" 谨慎使用内容脚本")]),e._v(" "),a("p",[e._v("尽管内容脚本生活在一个孤立的世界中，但它们无法免受攻击：")]),e._v(" "),a("ul",[a("li",[e._v("内容脚本是扩展的唯一可以直接与网页交互的部分。因此，恶意网页可能会操纵内容脚本所依赖的 DOM 部分，或者利用 Web 标准行为，例如"),a("a",{attrs:{href:"https://html.spec.whatwg.org/#dom-window-nameditem",target:"_blank",rel:"noopener noreferrer"}},[e._v("命名项"),a("OutboundLink")],1),e._v("。")]),e._v(" "),a("li",[e._v("为了与网页的 DOM 交互，内容脚本需要在与网页相同的渲染器进程中执行。这使得内容脚本容易受到通过旁通道攻击（例如 "),a("a",{attrs:{href:"https://spectreattack.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Spectre"),a("OutboundLink")],1),e._v("）数据泄漏的威胁，并且如果恶意网页感染了渲染器进程，则很容易被攻击者接管。")])]),e._v(" "),a("p",[e._v("敏感的任务应在专用进程中执行，例如扩展程序的后台脚本。避免意外地将扩展特权暴露给内容脚本：")]),e._v(" "),a("ul",[a("li",[e._v("假设来自内容脚本的消息可能是攻击者制作的（例如，验证并清除所有输入并保护您的脚本免受跨站脚本攻击）。")]),e._v(" "),a("li",[e._v("假设发送到内容脚本的任何数据都可能泄漏到网页上。请勿将敏感数据（例如扩展中的密钥，其他 Web 来源的数据，浏览历史记录）发送到内容脚本。")]),e._v(" "),a("li",[e._v("限制可以由内容脚本触发的特权操作的范围。不允许内容脚本触发"),a("a",{attrs:{href:"https://developer.chrome.com/xhr#xhr-vs-content-scripts",target:"_blank",rel:"noopener noreferrer"}},[e._v("对任意 URL 的请求"),a("OutboundLink")],1),e._v("或将任意参数传递给扩展 API（例如，不允许将任意 URL传递给 fetch 或 chrome.tabs.create API）。")])]),e._v(" "),a("h3",{attrs:{id:"注册并清理输入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注册并清理输入"}},[e._v("#")]),e._v(" 注册并清理输入")]),e._v(" "),a("p",[e._v("通过将监听器限制为扩展所期望的内容，验证传入数据的发送方并清除所有输入，来保护扩展免受恶意脚本的攻击。")]),e._v(" "),a("p",[e._v("如果扩展期望从外部网站或扩展进行通信，则仅应注册 "),a("a",{attrs:{href:"https://developer.chrome.com/runtime#event-onMessageExternal",target:"_blank",rel:"noopener noreferrer"}},[e._v("runtime.onRequestExternal"),a("OutboundLink")],1),e._v("。 始终验证 sender 是否匹配受信任的来源。")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('  // The ID of an external extension\n  const kFriendlyExtensionId = "iamafriendlyextensionhereisdatas";\n\n  chrome.runtime.onMessageExternal.addListener(\n    function(request, sender, sendResponse) {\n      if (sender.id === kFriendlyExtensionId)\n        doSomething();\n  });\n')])])]),a("p",[e._v("即使是扩展本身通过 runtime.onMessage 事件发出的消息，也应进行仔细检查，以确保MessageSender 并非来自受感染的内容脚本。")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('chrome.runtime.onMessage.addListener(function(request, sender, sendResponse) {\n    if (request.allowedAction)\n      console.log("This is an allowed action.");\n  });\n')])])]),a("p",[e._v("通过清除用户输入和输出数据（甚至来自扩展本身和批准的源），防止扩展执行攻击者的脚本。 避免使用可执行的 API。")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("function sanitizeInput(input) {\n      return input.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/\"/g, '&quot;');\n  }\n")])])]),a("hr"),e._v(" "),a("p",[e._v("关注 微信公众号「"),a("strong",[e._v("程序化思维")]),e._v("」 获取最新 Chrome 插件开发教程。")]),e._v(" "),a("p",[a("img",{attrs:{src:"/mp1.png",alt:"mp_wechat"}})])])}),[],!1,null,null,null);t.default=s.exports}}]);